{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap c6d091a9229c08eade29","webpack:///./src/randomKey.js","webpack:///./src/workerCommunication.js","webpack:///./src/gdalDataset.js","webpack:///./src/index.js","webpack:///./src/api.js"],"names":["randomKey","length","chars","result","i","Math","floor","random","messages","workerPromise","_scripts","document","getElementsByTagName","THIS_SCRIPT","getPathPrefix","src","substring","lastIndexOf","initWorker","Promise","resolve","reject","_worker","Worker","onmessage","msg","data","ready","success","id","Error","message","addMessageResolver","callback","errback","key","hasOwnProperty","callWorker","name","args","then","worker","resolverId","gdalResult","reason","postMessage","function","arguments","GDALDataset","datasetPtr","filePath","directory","filename","_deleteSelf","translateResult","error","warpResult","open","flushFS","initialize","file","openResult"],"mappings":"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","file":"loam.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"loam\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"loam\"] = factory();\n\telse\n\t\troot[\"loam\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c6d091a9229c08eade29","// https://stackoverflow.com/questions/10726909/random-alpha-numeric-string-in-javascript\nexport default function randomKey(length = 32, chars = '0123456789abcdefghijklmnopqrstuvwxyz') {\n    let result = '';\n\n    for (let i = length; i > 0; i--) {\n        result += chars[Math.floor(Math.random() * chars.length)];\n    }\n    return result;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/randomKey.js","import randomKey from './randomKey.js';\n\nlet messages = {};\n\nlet workerPromise;\n\n// Cache the currently executing script at initialization so that we can use it later to figure\n// out where all the other scripts should be pulled from\nlet _scripts = document.getElementsByTagName('script');\nconst THIS_SCRIPT = _scripts[_scripts.length - 1];\n\n// Inspired by Emscripten's method for doing the same thing\nfunction getPathPrefix() {\n    return THIS_SCRIPT.src.substring(\n        0,\n        THIS_SCRIPT.src.lastIndexOf('/')\n    ) + '/';\n}\n\n// Set up a WebWorker and an associated promise that resolves once it's ready\nfunction initWorker() {\n    if (typeof workerPromise === 'undefined') {\n        workerPromise = new Promise(function (resolve, reject) {\n            let _worker = new Worker(getPathPrefix() + 'loam-worker.js');\n\n            // The worker needs to do some initialization, and will send a message when it's ready.\n            _worker.onmessage = function (msg) {\n                if (msg.data.ready) {\n                    // Once the worker's ready, change the onMessage function to execute and clear\n                    // the stored promise resolvers.\n                    _worker.onmessage = function (msg) {\n                        // Execute stored promise resolver by message ID\n                        // Promise resolvers are stored by callWorker().\n                        if (msg.data.success) {\n                            messages[msg.data.id][0](msg.data.result);\n                        } else {\n                            messages[msg.data.id][1](new Error(msg.data.message));\n                        }\n                        delete messages[msg.data.id];\n                    };\n                    resolve(_worker);\n                }\n            };\n        });\n    }\n    return workerPromise;\n}\n\n// Store a listener function with a key so that we can associate it with a message later.\nfunction addMessageResolver(callback, errback) {\n    let key = randomKey();\n\n    while (messages.hasOwnProperty(key)) {\n        key = randomKey();\n    }\n    messages[key] = [callback, errback];\n    return key;\n}\n\n// Call the GDAL API function specified by `name`, with an array of arguments\nfunction callWorker(name, args) {\n    return initWorker().then((worker) => {\n        return new Promise(function (resolve, reject) {\n            let resolverId = addMessageResolver(\n                function (gdalResult) {\n                    resolve(gdalResult);\n                },\n                function (reason) {\n                    reject(reason);\n                }\n            );\n\n            worker.postMessage({\n                id: resolverId,\n                function: name,\n                arguments: args\n            });\n        });\n    });\n}\n\nexport { initWorker, callWorker };\n\n\n\n// WEBPACK FOOTER //\n// ./src/workerCommunication.js","import { callWorker } from './workerCommunication.js';\n\nexport default class GDALDataset {\n    constructor(datasetPtr, filePath, directory, filename) {\n        this.datasetPtr = datasetPtr;\n        this.filePath = filePath;\n        this.directory = directory;\n        this.filename = filename;\n    }\n\n    _deleteSelf() {\n        delete this.datasetPtr;\n        delete this.filePath;\n        delete this.directory;\n        delete this.filename;\n    }\n\n    close() {\n        return callWorker('GDALClose', [this.datasetPtr, this.directory, this.filePath])\n            .then(\n                result => {\n                    this._deleteSelf();\n                    return result;\n                },\n                reason => {\n                    this._deleteSelf();\n                    throw reason;\n                }\n            );\n    }\n\n    closeAndReadBytes() {\n        return callWorker('GDALClose', [this.datasetPtr, this.directory, this.filePath, true])\n            .then(result => {\n                this._deleteSelf();\n                return result;\n            },\n            reason => {\n                this._deleteSelf();\n                throw reason;\n            });\n    }\n\n    count() {\n        return callWorker('GDALGetRasterCount', [this.datasetPtr]);\n    }\n\n    width() {\n        return callWorker('GDALGetRasterXSize', [this.datasetPtr]);\n    }\n\n    height() {\n        return callWorker('GDALGetRasterYSize', [this.datasetPtr]);\n    }\n\n    wkt() {\n        return callWorker('GDALGetProjectionRef', [this.datasetPtr]);\n    }\n\n    transform() {\n        return callWorker('GDALGetGeoTransform', [this.datasetPtr]);\n    }\n\n    convert(args) {\n        return callWorker('GDALTranslate', [this.datasetPtr, args]).then(\n            function (translateResult) {\n                return new GDALDataset(\n                    translateResult.datasetPtr,\n                    translateResult.filePath,\n                    translateResult.directory,\n                    translateResult.filename\n                );\n            },\n            function (error) { throw error; }\n        );\n    }\n\n    warp(args) {\n        return callWorker('GDALWarp', [this.datasetPtr, args]).then(\n            function (warpResult) {\n                return new GDALDataset(\n                    warpResult.datasetPtr,\n                    warpResult.filePath,\n                    warpResult.directory,\n                    warpResult.filename\n                );\n            },\n            function (error) { throw error; }\n        );\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/gdalDataset.js","import { open, flushFS, initialize } from './api.js';\nimport GDALDataset from './gdalDataset.js';\n\nexport default { open, flushFS, GDALDataset, initialize };\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import { initWorker, callWorker } from './workerCommunication.js';\nimport GDALDataset from './gdalDataset.js';\n\nfunction open(file) {\n    return callWorker('GDALOpen', [file]).then(\n        function (openResult) {\n            return new GDALDataset(\n                openResult.datasetPtr,\n                openResult.filePath,\n                openResult.directory,\n                openResult.filename\n            );\n        },\n        function (error) { throw error; }\n    );\n}\n\nfunction flushFS() {\n    return callWorker('LoamFlushFS', []);\n}\n\nfunction initialize() {\n    return initWorker();\n}\n\nexport { open, flushFS, initialize };\n\n\n\n// WEBPACK FOOTER //\n// ./src/api.js"],"sourceRoot":""}